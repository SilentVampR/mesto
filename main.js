!function(){"use strict";const e={formSelector:".popup__form-container",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_disabled",inputErrorClass:"popup__input_state_not-valid",errorClass:"popup__text-error_state_not-valid",inputContainer:".popup__input-container",errorText:".popup__text-error",templateId:"#cardTemplate",profileNameSelector:".profile__name",profileAboutSelector:".profile__about",profileAvatarSelector:".profile__avatar",sectionCards:".cards"};class t{constructor({data:e,imageOpener:t,confirmOpener:r,handleLikeButton:s},o,i){this._link=e.link,this._name=e.name,this._id=e._id,this._ownerId=e.owner._id,this._likesArr=e.likes,this._likesCount=e.likes.length,this._templateSelector=o,this._myId=i,this._imageOpener=t,this._confirmOpener=r,this._handleLikeButton=s,this._imageOpener=this._imageOpener.bind(this),this._confirmOpener=this._confirmOpener.bind(this),this._handleLikeButton=this._handleLikeButton.bind(this)}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".card").cloneNode(!0)}_setEventListeners(){this._element.querySelector(".card__like-button").addEventListener("click",this._handleLikeButton),this._element.querySelector(".card__image").addEventListener("click",this._imageOpener)}generateCard(){this._element=this._getTemplate(),this._element.id=this._id;const e=this._element.querySelector(".card__image");if(e.src=this._link,e.alt=this._name,this._element.querySelector(".card__title").textContent=this._name,this._element.querySelector(".card__like-counter").textContent=this._likesCount,this._likesArr.forEach((e=>{e._id===this._myId&&this._element.querySelector(".card__like-button").classList.add("card__like-button_active")})),this._ownerId===this._myId){const e=this._element.querySelector(".card__delete-button");e.classList.add("card__delete-button_active"),e.addEventListener("click",this._confirmOpener)}return this._setEventListeners(),this._element}}class r{constructor(e,t){this._formElement=t,this._settings=e,this._inputListArray=Array.from(this._formElement.querySelectorAll(this._settings.inputSelector)),this._formButton=this._formElement.querySelector(this._settings.submitButtonSelector)}_toggleInputError(e,t){const r=e.closest(this._settings.inputContainer).querySelector(this._settings.errorText);t?(r.textContent=t,r.classList.add(this._settings.errorClass)):(r.textContent="",r.classList.remove(this._settings.errorClass))}hideInputErrors(){this._inputListArray.forEach((e=>{this._toggleInputError(e),this._changeButtonState()}))}_checkInputValidity(e){if(e.validity.valid)this._toggleInputError(e);else{const t=e.validationMessage;this._toggleInputError(e,t)}}_changeButtonState(){this._inputListArray.some((e=>!e.validity.valid))?(this._formButton.setAttribute("disabled",!0),this._formButton.classList.add(this._settings.inactiveButtonClass)):(this._formButton.removeAttribute("disabled",!0),this._formButton.classList.remove(this._settings.inactiveButtonClass))}_setEventListeners(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._changeButtonState(),this._inputListArray.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._changeButtonState()}))}))}enableValidation(){this._setEventListeners()}}class s{constructor(e){this._popup=document.querySelector(e),this._popupCloseButton=this._popup.querySelector(".popup__close-button"),this._handleEscClose=this._handleEscClose.bind(this),this._handleOverlayClose=this._handleOverlayClose.bind(this),this._close=this.close.bind(this)}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleOverlayClose(e){e.target===e.currentTarget&&this.close()}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keyup",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keyup",this._handleEscClose)}setEventListeners(){this._popupCloseButton.addEventListener("click",this._close),this._popup.addEventListener("click",this._handleOverlayClose)}}class o extends s{constructor({formSelector:e,inputSelector:t,formSubmitCallback:r},s){super(s),this._formElement=this._popup.querySelector(e),this._formSubmitCallBack=r,this._inputArr=Array.from(this._formElement.querySelectorAll(t)),this._handleSubmit=this._handleSubmit.bind(this)}_getInputValues(){const e={};return this._inputArr.forEach((t=>e[t.name]=t.value)),e}_handleSubmit(e){e.preventDefault(),this._formSubmitCallBack(this._getInputValues()),this.close()}setEventListeners(){this._formElement.addEventListener("submit",this._handleSubmit),super.setEventListeners()}close(){super.close(),this._formElement.reset()}}class i{constructor({items:e,renderer:t},r){this._items=e,this._renderer=t,this._container=document.querySelector(r)}renderItem(){this._items.reverse(),this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}const n=new class{constructor({apiURL:e,headers:t}){this._apiURL=e,this._headers=t}getUserInfo(){return fetch(this._apiURL+"/users/me",{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка получения информации о пользователе с сервера - ${e.status}`)))}getInitialCards(){return fetch(this._apiURL+"/cards/",{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка получения карточек с сервера - ${e.status}`)))}addNewPlace(e){return fetch(this._apiURL+"/cards",{method:"POST",body:JSON.stringify({name:e.placeName,link:e.placeUrl}),headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка добавления карточки на сервер - ${e.status}`)))}removeCard(e){return fetch(this._apiURL+"/cards/"+e,{method:"DELETE",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка удаления карточки с сервера - ${e.status}`)))}addLike(e){return fetch(this._apiURL+"/cards/likes/"+e,{method:"PUT",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка добавления лайка для карточки - ${e.status}`)))}removeLike(e){return fetch(this._apiURL+"/cards/likes/"+e,{method:"DELETE",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка удаления лайка для карточки - ${e.status}`)))}editAvatar(e){return fetch(this._apiURL+"/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e.avatarUrl}),headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка изменения аватара пользователя - ${e.status}`)))}editUserInfo(e){return fetch(this._apiURL+"/users/me",{method:"PATCH",body:JSON.stringify({name:e.profileAuthorName,about:e.profileAuthorAbout}),headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка изменения информации пользователя - ${e.status}`)))}}({apiURL:"https://mesto.nomoreparties.co/v1/cohort-27",headers:{authorization:"beb35b1a-7d6a-4743-95a3-06e29b783755","Content-Type":"application/json; charset=UTF-8"}}),a=(e,t)=>{t.querySelector(".popup__submit-button").textContent=e?"Сохранение...":"Сохранить"},l=document.querySelector(".profile"),c=l.querySelector(e.profileNameSelector),u=l.querySelector(e.profileAboutSelector),_=l.querySelector(e.profileAvatarSelector),p=l.querySelector(".profile__edit-button");n.getUserInfo().then((e=>{c.textContent=e.name,u.textContent=e.about,_.src=e.avatar,_.alt=e.name})).catch((e=>console.log(e)));const h=new class{constructor({profileNameSelector:e,profileAboutSelector:t}){this._userName=document.querySelector(e),this._userAbout=document.querySelector(t)}getUserInfo(){return{name:this._userName.textContent,about:this._userAbout.textContent}}setUserInfo(e){this._userName.textContent=e.profileAuthorName,this._userAbout.textContent=e.profileAuthorAbout}}({profileNameSelector:e.profileNameSelector,profileAboutSelector:e.profileAboutSelector}),d=new o({formSelector:e.formSelector,inputSelector:e.inputSelector,formSubmitCallback:e=>{a(!0,d._popup),n.editUserInfo(e).then((()=>{h.setUserInfo(e)})).then((()=>{a(!1,d._popup)})).catch((e=>console.log(e)))}},".popup_type_profile-edit"),m=new r(e,d._formElement);m.enableValidation(),d.setEventListeners(),p.addEventListener("click",(()=>{const{name:e,about:t}=h.getUserInfo();d._popup.querySelector(".popup__input_author_name").value=e,d._popup.querySelector(".popup__input_author_about").value=t,m.hideInputErrors(),d.open()}));const f=new o({formSelector:e.formSelector,inputSelector:e.inputSelector,formSubmitCallback:e=>{a(!0,f._popup),n.editAvatar(e).then((e=>{var t;t=e.avatar,_.src=t})).then((()=>{a(!1,f._popup)})).catch((e=>console.log(e)))}},".popup_type_avatar-edit"),S=new r(e,f._formElement);S.enableValidation(),f.setEventListeners(),l.querySelector(".profile__edit-avatar").addEventListener("click",(()=>{S.hideInputErrors(),f.open()}));const b=new class extends s{constructor(e){super(e)}open({data:e}){const t=this._popup.querySelector(".popup__image");t.src=e.link,t.alt=e.name,this._popup.querySelector(".popup__image-caption").textContent=e.name,super.open()}}(".popup_type_image-overlay");b.setEventListeners();const v=new o({formSelector:e.formSelector,inputSelector:e.inputSelector,formSubmitCallback:e=>{(e=>{n.removeCard(e.placeId).then((()=>{document.querySelector(`#${CSS.escape(e.placeId)}`).remove()})).catch((e=>console.log(e)))})(e)}},".popup_type_confirm");v.setEventListeners();const y=r=>{const s=new i({items:r,renderer:r=>{s.addItem((r=>{const s=new t({data:r,imageOpener:()=>{b.open({data:{name:r.name,link:r.link,id:r._id}})},confirmOpener:()=>{v._popup.querySelector(".popup__input_place_id").value=r._id,v.open()},handleLikeButton:e=>{const t=document.querySelector(`#${CSS.escape(s._id)}`).querySelector(".card__like-counter"),o=e.target;o.classList.contains("card__like-button_active")?n.removeLike(r._id).then((e=>{o.classList.remove("card__like-button_active"),t.textContent=e.likes.length})).catch((e=>console.log(e))):n.addLike(r._id).then((e=>{o.classList.add("card__like-button_active"),t.textContent=e.likes.length})).catch((e=>console.log(e)))}},e.templateId,"dab90f1d297ca4e046afdd19");return s.generateCard()})(r))}},e.sectionCards);s.renderItem()};n.getInitialCards().then((e=>{y(e)})).catch((e=>{console.log(e)}));const k=document.querySelector(".add-button"),L=new o({formSelector:e.formSelector,inputSelector:e.inputSelector,formSubmitCallback:e=>{a(!0,L._popup),n.addNewPlace(e).then((e=>{y([e])})).then((()=>{a(!1,L._popup)})).catch((e=>{console.log(e)}))}},".popup_type_new-place"),g=new r(e,L._formElement);g.enableValidation(),L.setEventListeners(),k.addEventListener("click",(()=>{g.hideInputErrors(),L.open()}))}();