!function(){"use strict";const e={formSelector:".popup__form-container",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_disabled",inputErrorClass:"popup__input_state_not-valid",errorClass:"popup__text-error_state_not-valid",inputContainer:".popup__input-container",errorText:".popup__text-error",templateId:"#cardTemplate",profileNameSelector:".profile__name",profileAboutSelector:".profile__about",profileAvatarSelector:".profile__avatar",sectionCards:".cards"};class t{constructor({data:e,imageOpener:t,confirmOpener:r,handleLikeButton:s},o,i){this._link=e.link,this._name=e.name,this._id=e._id,this._ownerId=e.owner._id,this._likesArr=e.likes,this._templateSelector=o,this._myId=i,this._imageOpener=t,this._confirmOpener=r,this._handleLikeButton=s,this._imageOpener=this._imageOpener.bind(this),this._confirmOpener=this._confirmOpener.bind(this),this._handleLikeButton=this._handleLikeButton.bind(this)}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".card").cloneNode(!0)}_likesCount(e){return e.length}_setEventListeners(){this._element.querySelector(".card__like-button").addEventListener("click",this._handleLikeButton),this._element.querySelector(".card__image").addEventListener("click",this._imageOpener)}_generateLike(){this._likesArr.forEach((e=>{e._id===this._myId&&this._element.querySelector(".card__like-button").classList.add("card__like-button_active")}))}generateCard(){this._element=this._getTemplate(),this._element.id=this._id;const e=this._element.querySelector(".card__image");if(e.src=this._link,e.alt=this._name,this._element.querySelector(".card__title").textContent=this._name,this._element.querySelector(".card__like-counter").textContent=this._likesCount(this._likesArr),this._ownerId===this._myId){const e=this._element.querySelector(".card__delete-button");e.classList.add("card__delete-button_active"),e.addEventListener("click",this._confirmOpener)}return this._generateLike(),this._setEventListeners(),this._element}}class r{constructor(e,t){this._formElement=t,this._settings=e,this._inputListArray=Array.from(this._formElement.querySelectorAll(this._settings.inputSelector)),this._formButton=this._formElement.querySelector(this._settings.submitButtonSelector)}_toggleInputError(e,t){const r=e.closest(this._settings.inputContainer).querySelector(this._settings.errorText);t?(r.textContent=t,r.classList.add(this._settings.errorClass)):(r.textContent="",r.classList.remove(this._settings.errorClass))}hideInputErrors(){this._inputListArray.forEach((e=>{this._toggleInputError(e),this._changeButtonState()}))}_checkInputValidity(e){if(e.validity.valid)this._toggleInputError(e);else{const t=e.validationMessage;this._toggleInputError(e,t)}}_changeButtonState(){this._inputListArray.some((e=>!e.validity.valid))?(this._formButton.setAttribute("disabled",!0),this._formButton.classList.add(this._settings.inactiveButtonClass)):(this._formButton.removeAttribute("disabled",!0),this._formButton.classList.remove(this._settings.inactiveButtonClass))}_setEventListeners(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._changeButtonState(),this._inputListArray.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._changeButtonState()}))}))}enableValidation(){this._setEventListeners()}}class s{constructor(e){this._popup=document.querySelector(e),this._popupCloseButton=this._popup.querySelector(".popup__close-button"),this._handleEscClose=this._handleEscClose.bind(this),this._handleOverlayClose=this._handleOverlayClose.bind(this),this._close=this.close.bind(this)}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleOverlayClose(e){e.target===e.currentTarget&&this.close()}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keyup",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keyup",this._handleEscClose)}setEventListeners(){this._popupCloseButton.addEventListener("click",this._close),this._popup.addEventListener("click",this._handleOverlayClose)}}class o extends s{constructor({formSelector:e,inputSelector:t,formSubmitCallback:r},s){super(s),this._formElement=this._popup.querySelector(e),this._formSubmitCallBack=r,this._inputArr=Array.from(this._formElement.querySelectorAll(t)),this._handleSubmit=this._handleSubmit.bind(this)}_getInputValues(){const e={};return this._inputArr.forEach((t=>e[t.name]=t.value)),e}_handleSubmit(e){e.preventDefault(),this._formSubmitCallBack(this._getInputValues()),this.close()}setEventListeners(){this._formElement.addEventListener("submit",this._handleSubmit),super.setEventListeners()}close(){super.close(),this._formElement.reset()}}const i=new class{constructor({apiURL:e,headers:t}){this._apiURL=e,this._headers=t}_checkResponse(e,t){return e.ok?e.json():Promise.reject(`${t} - ${e.status}`)}getUserInfo(){return fetch(this._apiURL+"/users/me",{headers:this._headers}).then((e=>this._checkResponse(e,"Ошибка получения информации о пользователе с сервера")))}getInitialCards(){return fetch(this._apiURL+"/cards/",{headers:this._headers}).then((e=>this._checkResponse(e,"Ошибка получения карточек с сервера")))}addNewPlace(e){return fetch(this._apiURL+"/cards",{method:"POST",body:JSON.stringify({name:e.placeName,link:e.placeUrl}),headers:this._headers}).then((e=>this._checkResponse(e,"Ошибка добавления карточки на сервер")))}removeCard(e){return fetch(this._apiURL+"/cards/"+e,{method:"DELETE",headers:this._headers}).then((e=>this._checkResponse(e,"Ошибка удаления карточки с сервера")))}addLike(e){return fetch(this._apiURL+"/cards/likes/"+e,{method:"PUT",headers:this._headers}).then((e=>this._checkResponse(e,"Ошибка добавления лайка для карточки")))}removeLike(e){return fetch(this._apiURL+"/cards/likes/"+e,{method:"DELETE",headers:this._headers}).then((e=>this._checkResponse(e,"Ошибка удаления лайка для карточки")))}editAvatar(e){return fetch(this._apiURL+"/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e.avatarUrl}),headers:this._headers}).then((e=>this._checkResponse(e,"Ошибка изменения аватара пользователя")))}editUserInfo(e){return fetch(this._apiURL+"/users/me",{method:"PATCH",body:JSON.stringify({name:e.profileAuthorName,about:e.profileAuthorAbout}),headers:this._headers}).then((e=>this._checkResponse(e,"Ошибка изменения информации пользователя")))}}({apiURL:"https://mesto.nomoreparties.co/v1/cohort-27",headers:{authorization:"beb35b1a-7d6a-4743-95a3-06e29b783755","Content-Type":"application/json; charset=UTF-8"}}),n=(e,t)=>{t.querySelector(".popup__submit-button").textContent=e?"Сохранение...":"Сохранить"},a=document.querySelector(".profile"),l=a.querySelector(e.profileNameSelector),c=a.querySelector(e.profileAboutSelector),_=a.querySelector(e.profileAvatarSelector),h=a.querySelector(".profile__edit-button");i.getUserInfo().then((e=>{l.textContent=e.name,c.textContent=e.about,_.src=e.avatar,_.alt=e.name})).catch((e=>console.log(e)));const p=new class{constructor({profileNameSelector:e,profileAboutSelector:t}){this._userName=document.querySelector(e),this._userAbout=document.querySelector(t)}getUserInfo(){return{name:this._userName.textContent,about:this._userAbout.textContent}}setUserInfo(e){this._userName.textContent=e.profileAuthorName,this._userAbout.textContent=e.profileAuthorAbout}}({profileNameSelector:e.profileNameSelector,profileAboutSelector:e.profileAboutSelector}),u=new o({formSelector:e.formSelector,inputSelector:e.inputSelector,formSubmitCallback:e=>{n(!0,u._popup),i.editUserInfo(e).then((()=>{p.setUserInfo(e)})).then((()=>{n(!1,u._popup)})).catch((e=>console.log(e)))}},".popup_type_profile-edit"),d=new r(e,u._formElement);d.enableValidation(),u.setEventListeners(),h.addEventListener("click",(()=>{const{name:e,about:t}=p.getUserInfo();u._popup.querySelector(".popup__input_author_name").value=e,u._popup.querySelector(".popup__input_author_about").value=t,d.hideInputErrors(),u.open()}));const m=new o({formSelector:e.formSelector,inputSelector:e.inputSelector,formSubmitCallback:e=>{n(!0,m._popup),i.editAvatar(e).then((e=>{var t;t=e.avatar,_.src=t})).then((()=>{n(!1,m._popup)})).catch((e=>console.log(e)))}},".popup_type_avatar-edit"),f=new r(e,m._formElement);f.enableValidation(),m.setEventListeners(),a.querySelector(".profile__edit-avatar").addEventListener("click",(()=>{f.hideInputErrors(),m.open()}));const S=new class extends s{constructor(e){super(e)}open({data:e}){const t=this._popup.querySelector(".popup__image");t.src=e.link,t.alt=e.name,this._popup.querySelector(".popup__image-caption").textContent=e.name,super.open()}}(".popup_type_image-overlay");S.setEventListeners();const v=new o({formSelector:e.formSelector,inputSelector:e.inputSelector,formSubmitCallback:e=>{(e=>{i.removeCard(e.placeId).then((()=>{document.querySelector(`#${CSS.escape(e.placeId)}`).remove()})).catch((e=>console.log(e)))})(e)}},".popup_type_confirm");v.setEventListeners();const b=new class{constructor({renderer:e},t,r){this._renderer=e,this._container=document.querySelector(t),this._api=r}_renderItem(e){e.reverse(),e.forEach((e=>{this._renderer(e)}))}generateItems(){this._api.getInitialCards().then((e=>{this._renderItem(e)}))}saveItem(e){this._renderer(e)}addItem(e){this._container.prepend(e)}}({renderer:r=>{b.addItem((r=>{const s=new t({data:r,imageOpener:()=>{S.open({data:{name:r.name,link:r.link,id:r._id}})},confirmOpener:()=>{v._popup.querySelector(".popup__input_place_id").value=r._id,v.open()},handleLikeButton:e=>{const t=document.querySelector(`#${CSS.escape(s._id)}`).querySelector(".card__like-counter"),o=e.target;o.classList.contains("card__like-button_active")?i.removeLike(r._id).then((e=>{o.classList.remove("card__like-button_active"),t.textContent=s._likesCount(e.likes)})).catch((e=>console.log(e))):i.addLike(r._id).then((e=>{o.classList.add("card__like-button_active"),t.textContent=s._likesCount(e.likes)})).catch((e=>console.log(e)))}},e.templateId,"dab90f1d297ca4e046afdd19");return s.generateCard()})(r))}},e.sectionCards,i);b.generateItems();const k=document.querySelector(".add-button"),y=new o({formSelector:e.formSelector,inputSelector:e.inputSelector,formSubmitCallback:e=>{n(!0,y._popup),i.addNewPlace(e).then((e=>{b.saveItem(e)})).then((()=>{n(!1,y._popup)})).catch((e=>{console.log(e)}))}},".popup_type_new-place"),L=new r(e,y._formElement);L.enableValidation(),y.setEventListeners(),k.addEventListener("click",(()=>{L.hideInputErrors(),y.open()}))}();